# 	SOC111 - Traffic to Malware Domain (Event ID:46)

## Executive Summary

On January 31, 2021, the Security Operations Center (SOC) received a critical alert for traffic to a known malware domain originating from the host **RichardPRD** (172.16.17.45). The investigation confirmed that this activity was the second stage of a successful exploit of **CVE-2017-11882** (the Microsoft Equation Editor vulnerability). The endpoint logs show that `excel.exe` spawned the vulnerable `EQNEDT32.EXE` process, which then made an outbound GET request to download a secondary payload, `network.exe`, from the malicious domain `andaluciabeach.net`. The `Device Action: Allowed` confirms this download was successful. The host is fully compromised and has active malware on it.

## Incident Details

The initial alert was triggered by an outbound connection to a known-malicious domain:

<img width="1464" height="536" alt="image" src="https://github.com-attachments/assets/02d96625-8f7d-4754-820d-181710480fe6" />

| | |
| :--- | :--- |
| **Date of Incident**| January 31, 2021 |
| **Source Host**| RichardPRD (172.16.17.45) |
| **Username**| Richard |
| **Malicious Domain**| andaluciabeach.net (5.135.143.133) |
| **Downloaded File**| `network.exe` |
| **Attack Type**| Second-Stage Malware Download (Post-Exploitation) |
| **Case Link**| *([Case link](https://app.letsdefend.io/case-management/casedetail/sohankanna/46))* |

## Investigation and Analysis

### 1. Alert Context and Threat Intelligence

The alert `SOC111 - Traffic to Malware Domain` is a high-confidence indicator of compromise. It means a host on the internal network is communicating with an external server known to host malware, C2 infrastructure, or phishing sites.
*   **Threat Intelligence (VirusTotal):** A check on the destination domain `andaluciabeach.net` confirmed its malicious reputation, with 4 security vendors flagging it.
    <img width="1697" height="751" alt="image" src="https://github.com-attachments/assets/5d95512e-3ed3-4291-a436-33f5c22c4d60" />

### 2. Correlating with the Initial Exploit

The key to understanding this alert is linking it to the initial access vector.
*   **Log Management:** The network logs show that the process responsible for this malicious connection was `EQNEDT32.EXE`, with a parent process of `excel.exe`.
    <img width="903" height="430" alt="image" src="https://github.com/user-attachments/assets/fbfc6bf0-2afa-4f94-8492-cf928a4c2316" />
*   **The Exploit Chain:** This process hierarchy (`excel.exe` -> `EQNEDT32.EXE` -> Malicious Network Connection) is the classic signature of the **CVE-2017-11882** exploit. The user `Richard` likely opened a malicious Excel document which exploited the Equation Editor vulnerability to achieve RCE. The code executed by the exploit then instructed the `EQNEDT32.EXE` process to download the next stage of the malware, `network.exe`.

### 3. Confirmation of Successful Download

Multiple log sources confirm that the secondary payload was successfully downloaded to the host.
*   **Network Logs:** The `Request URL` (`http://andaluciabeach.net/image/network.exe`) shows a direct request for an executable file. The `Device Action: Allowed` confirms that the proxy or firewall did not block this download.
*   **Endpoint Logs:** The EDR logs corroborate this finding, showing the `EQNEDT32.EXE` process running and its associated network connection to the malicious domain.
    <img width="1097" height="388" alt="image" src="https://github.com/user-attachments/assets/86fabed3-221d-484d-9aad-1a900b96fb5c" />
    <img width="1015" height="215" alt="image" src="https://github.com/user-attachments/assets/00cad795-b190-4e1a-afcc-9d955344419a" />

Although there is no log showing the immediate execution of `network.exe`, the fact that it was successfully downloaded to the machine means a full compromise must be assumed.

## Skills and Tools Utilized

*   **Tools Used:** SIEM, EDR, Network Logs, VirusTotal
*   **Skills Demonstrated:** Post-Exploitation Analysis, Attack Chain Reconstruction, Log Correlation, C2 Traffic Identification.

## Playbook Solution: Incident Classification

*   **Is Traffic Malicious?** **Yes.** It is a download of an executable from a known malware domain.
*   **What Is The Attack Type?** **Malware Download / Post-Exploitation.**
*   **Was the Attack Successful?** **Yes.** The executable file was successfully downloaded to the endpoint.
*   **Do You Need Tier 2 Escalation?** **Yes.** A confirmed malware download on a host is a critical incident.
*   **Incident Classification:** **True Positive.**

## Conclusion and Recommendations

The alert for SOC111 was a **true positive** for a successful second-stage malware download. This event is a direct continuation of a prior compromise via a phishing email exploiting CVE-2017-11882. The host **RichardPRD** is fully compromised, and an active malware executable (`network.exe`) is now present on the system.

**Recommendations:**

1.  **CONTAINMENT - Isolate Host Immediately:** Disconnect the host **RichardPRD** (172.16.17.45) from the network to prevent the newly downloaded `network.exe` from executing, establishing its own C2 channel, or spreading laterally.
2.  **CREDENTIALS - Disable and Reset:** Immediately disable the `Richard` user account in Active Directory and reset their password.
3.  **ESCALATE:** Immediately escalate this incident to the Tier 2/Incident Response (IR) team for full forensic analysis.
4.  **INVESTIGATION:** The IR team's top priority is to find and analyze the `network.exe` file. They must determine its capabilities (e.g., is it a RAT, ransomware, infostealer?), find its hash, and hunt for any signs of its execution or persistence mechanisms.
5.  **RECOVERY:** The compromised host cannot be trusted and must be wiped and re-imaged from a known-good source.
6.  **BLOCK INDICATORS:**
    *   **IP/Domains:** Block the C2 domain (`andaluciabeach.net`) and IP (`5.135.143.133`) at the perimeter.
    *   **Hash:** Once known, add the hash of `network.exe` to the EDR blocklist.















