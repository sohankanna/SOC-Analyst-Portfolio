# SOC173 - Follina 0-Day Detected (Event ID:123)

## Executive Summary

On June 2, 2022, the Security Operations Center (SOC) received an alert for the exploitation of the "Follina" zero-day vulnerability on the host **JonasPRD** (172.16.17.39). The investigation confirmed that the user opened a malicious Microsoft Office document (`05-2022-0438.doc`) which leveraged **CVE-2022-30190** to achieve Remote Code Execution (RCE). The exploit abused the Microsoft Support Diagnostic Tool (`msdt.exe`) to execute malicious code. The `AV Action: Allowed` status confirms the exploit was not blocked, and network logs show a successful outbound connection to a known malicious C2 server (`141.105.65.149`). The host is fully compromised. This is a **True Positive** critical incident.

## Incident Details

The initial alert was triggered by the suspicious execution of `msdt.exe` immediately following the opening of an Office document:

<img width="1458" height="564" alt="image" src="https://github.com/user-attachments/assets/f5650d33-9876-4ad7-9f6b-c11736a567e4" />

| | |
| :--- | :--- |
| **Date of Incident**| June 2, 2022 |
| **Source Host**| JonasPRD (172.16.17.39) |
| **Malware File**| `05-2022-0438.doc` |
| **File Hash (MD5)**| 52945af1def85b171870b31fa4782e52 |
| **Vulnerability**| CVE-2022-30190 ("Follina") |
| **Attacker C2 IP**| 141.105.65.149 |
| **Attack Type**| Remote Code Execution (RCE) via Malicious Document |
| **Case Link**| *([Case link](https://app.letsdefend.io/case-management/casedetail/sohankanna/123))* |

## Investigation and Analysis

### 1. Vulnerability Profile: "Follina" (CVE-2022-30190)

**CVE-2022-30190**, nicknamed **"Follina,"** is a critical RCE vulnerability that abuses a legitimate Windows component, the Microsoft Support Diagnostic Tool (`msdt.exe`), through Office's URL protocol handlers.
*   **How it Works:** An attacker crafts a malicious Office document (e.g., `.doc`, `.rtf`) that contains a specially formed `ms-msdt:` URL. When the document is opened or even previewed, the Office application calls out to `msdt.exe` to handle this URL. The attacker can pass parameters through this URL that cause `msdt.exe` to download and execute arbitrary code, such as a PowerShell script, from a remote server.
*   **Significance:** Follina was a "zero-day" vulnerability, meaning it was actively exploited by attackers before a patch was available. It is particularly dangerous because it does not rely on traditional macros, bypassing a common security control, and could be triggered in some cases simply by previewing the document in Windows Explorer, making it a "zero-click" vector.
*   **Key Indicator:** The primary indicator of this exploit is an Office application (like `WINWORD.EXE`) spawning a child process of `msdt.exe`.

### 2. Malware and Threat Intelligence Analysis

The investigation confirmed the malicious nature of the document.
*   **Threat Intelligence (VirusTotal):** The file hash was flagged as malicious by **47 out of 71 security vendors**.
    <img width="1620" height="901" alt="image" src="https://github.com/user-attachments/assets/d2a6a909-96f5-4882-b490-2f43ddf9a135" />
*   **Dynamic Analysis (Hybrid Analysis):** A sandbox run returned a **100/100 malicious score**, confirming its hostile intent and providing a list of C2 servers it contacts.
    <img width="1574" height="820" alt="image" src="https://github.com/user-attachments/assets/1666a57d-07ee-4011-9752-54cb59d69569" />
    <img width="692" height="389" alt="image" src="https://github.com/user-attachments/assets/8bd6fe30-c40b-452d-808d-94af674b018c" />

### 3. Confirmation of Successful Exploitation and C2 Communication

The investigation confirmed that the user opened the file, the exploit was successful, and a C2 channel was established.
*   **Execution Allowed:** The SIEM alert clearly states the `AV Action` was `Allowed`, meaning the EDR/antivirus did not block the initial document or the subsequent exploit behavior.
*   **C2 Connection (The "Smoking Gun"):** Network logs show a successful outbound connection from the compromised host `JonasPRD` to the IP address `141.105.65.149`. This IP is one of the C2 servers identified by threat intelligence for this exact malware. The destination hostname `www.xmlformats.com` is likely spoofed or a compromised domain used by the attacker to host their payload. This log confirms that the `msdt.exe` process successfully reached out to the attacker's server to download and execute its malicious code.
    <img width="1392" height="442" alt="image" src="https://github.com/user-attachments/assets/23aa61e6-5e9a-49cc-a3c8-12f2f8190be9" />

## Skills and Tools Utilized

*   **Tools Used:** SIEM, EDR, Network Logs, VirusTotal, Hybrid Analysis
*   **Skills Demonstrated:** Zero-Day Exploit Analysis (Follina/CVE-2022-30190), C2 Traffic Identification, Log Correlation, TTP Recognition.

## Playbook Solution: Incident Classification

*   **Analyze Malware:** **Malicious.** The file is a confirmed exploit document for CVE-2022-30190.
*   **Was the Attack Successful?** **Yes.** The exploit ran, and a successful C2 connection was made.
*   **Do You Need Tier 2 Escalation?** **Yes.** A successful RCE via a zero-day exploit is a critical incident.
*   **Incident Classification:** **True Positive.**

## Conclusion and Recommendations

The alert for SOC173 was a **true positive** for a critical and successful RCE attack. An attacker exploited the Follina zero-day vulnerability (CVE-2022-30190) to compromise the host **JonasPRD**. The host is fully compromised and has established a connection with an attacker-controlled C2 server.

**Recommendations:**

1.  **CONTAINMENT - Isolate Host Immediately:** Disconnect the host **JonasPRD** (172.16.17.39) from the network to sever the active C2 connection and prevent lateral movement.
2.  **CREDENTIALS - Disable and Reset:** Immediately disable the `Jonas` user account and reset their password.
3.  **ESCALATE:** Immediately escalate this incident to the Tier 2/Incident Response (IR) team for a full forensic investigation.
4.  **INVESTIGATION:** The IR team must perform a full forensic analysis to determine what payload was downloaded from the C2 server and what actions the attacker took post-compromise.
5.  **PATCHING:** The highest priority for the organization is to ensure all Windows systems are patched against CVE-2022-30190.
6.  **RECOVERY:** The compromised host cannot be trusted and must be wiped and re-imaged from a known-good source.
7.  **BLOCK INDICATORS:**
    *   **IPs:** Block all C2 IP addresses identified by threat intelligence, including `141.105.65.149`, at the network firewall.
    *   **Hash:** Add the file hash `52945af1def85b171870b31fa4782e52` to the EDR blocklist.
8.  **Initial Access Vector:** The IR team should investigate the delivery mechanism of the `.doc` file (almost certainly a phishing email) and hunt for it in other user mailboxes.























