# 	SOC125 - Suspicious Rundll32 Activity (Event ID:58)

## Executive Summary

On February 14, 2021, the Security Operations Center (SOC) received a high-severity alert for suspicious activity involving `rundll32.exe` on the host **EmilyComp** (172.16.17.49). The investigation confirmed the execution of a malicious file, `KBDYAK.exe`, which has been definitively identified by threat intelligence as the **Emotet trojan**. The `Device Action: Allowed` status indicates that endpoint security controls failed to prevent the malware from running. Network logs provide a "smoking gun," showing a successful command-and-control (C2) connection from the compromised host to a known Emotet C2 server. The host is actively compromised and poses a severe risk to the network. This is a **True Positive** critical incident.

## Incident Details

The initial alert was triggered by behavior associated with advanced malware frameworks:

<img width="1457" height="469" alt="image" src="https://github.com/user-attachments/assets/7f125e6e-ef3e-4e20-80f5-f10f39cc142b" />

| | |
| :--- | :--- |
| **Date of Incident**| February 14, 2021 |
| **Attacker C2 IP**| 167.71.149.207 (and others) |
| **Destination Host**| EmilyComp (172.16.17.49) |
| **Malware File**| KBDYAK.exe |
| **File Hash (MD5)**| a4513379dad5233afa402cc56a8b9222 |
| **Malware Family**| Emotet (Trojan/Banker/Downloader) |
| **Case Link**| *([Case link](https://app.letsdefend.io/case-management/casedetail/sohankanna/58))* |

## Investigation and Analysis

### 1. Alert Context: Rundll32 Abuse and Emotet

**Suspicious Rundll32 Activity:** `Rundll32.exe` is a legitimate Windows process used to execute functions within DLL files. Attackers abuse it as a "living-off-the-land" binary (LOLBin) to run their malicious code. By using a trusted system utility, they can bypass simple application whitelisting and make their activity appear more like normal system behavior. This is a common TTP for sophisticated malware like Emotet.

**Emotet Trojan:** Emotet is one of the most dangerous and widespread malware families. It is a polymorphic trojan, meaning it constantly changes its code to evade signature-based detection. While it started as a banking trojan, its primary function now is as a **dropper** or **downloader**. Once Emotet infects a machine, its main goal is to establish persistence and then download other, often more destructive, malware, such as TrickBot, Qakbot, and ultimately, ransomware like Conti or Ryuk. An Emotet infection is often the precursor to a full-scale ransomware attack.

### 2. Malware Analysis

Threat intelligence provided a definitive identification of the malware.
*   **VirusTotal:** The hash `a4513379dad5233afa402cc56a8b9222` was flagged as malicious by **59 security vendors**, with the popular threat label being **`trojan.emotet`**.
    <img width="1694" height="812" alt="image" src="https://github.com/user-attachments/assets/4cb7bc16-932f-4774-92d3-621cdc1e7fb7" />
*   **Hybrid Analysis:** The sandbox run returned a **100/100 malicious score** and provided a list of C2 servers the malware attempts to contact.
    <img width="1806" height="786" alt="image" src="https://github.com/user-attachments/assets/3e2462ac-2e01-4ae8-8a9c-c37c63db6c5d" />
    <img width="1651" height="472" alt="image" src="https://github.com/user-attachments/assets/79c4b9db-6e5d-4b34-ad0a-a224e5075232" />

### 3. Confirmation of Execution and C2 Communication

The investigation confirmed a full compromise by correlating the alert data with endpoint logs.
*   **Execution Allowed:** The SIEM alert clearly states the `Device Action` was `Allowed`, meaning the EDR/antivirus did not block the `KBDYAK.exe` file from running.
*   **C2 Connection (The "Smoking Gun"):** Endpoint security logs show a successful network connection from the compromised host `EmilyComp` to the IP address `67.68.210.95`. This IP is one of the C2 servers identified in the Hybrid Analysis report for this exact malware sample. This confirms the Emotet beacon was successful and the host is under attacker control.
    <img width="868" height="178" alt="image" src="https://github.com/user-attachments/assets/1cdfcba7-e3c0-41a3-b143-136a381b4df2" />

## Skills and Tools Utilized

*   **Tools Used:** SIEM, EDR, Network Logs, VirusTotal, Hybrid Analysis
*   **Skills Demonstrated:** Malware Analysis (Emotet), LOLBin Triage (Rundll32), C2 Traffic Identification, Log Correlation.

## Playbook Solution: Incident Classification

*   **Analyze Malware:** **Malicious.** The file is a confirmed Emotet trojan.
*   **Was C2 Requested?** **Yes, Accessed.** The host is actively beaconing to a known Emotet C2 server.
*   **Was Malware Quarantined?** **No.** The `Device Action` was `Allowed`.
*   **Incident Classification:** **True Positive.**

## Conclusion and Recommendations

The alert for SOC125 was a **true positive** for a critical infection by the Emotet trojan. The malware was successfully executed on the host **EmilyComp** and has established a command-and-control channel. This host should be considered a major threat to the network, as it is likely a staging ground for a more severe attack, such as ransomware.

**Recommendations:**

1.  **CONTAINMENT - Isolate Host Immediately:** Disconnect the host **EmilyComp** (172.16.17.49) from the network to sever the active C2 connection and prevent lateral movement.
2.  **CREDENTIALS - Disable and Reset:** Immediately disable the `Emily` user account and reset their password. Emotet is known for its credential-stealing capabilities.
3.  **ESCALATE:** Immediately escalate this incident to the Tier 2/Incident Response (IR) team for a full-scale response.
4.  **INVESTIGATION:** The IR team's top priority is to hunt for lateral movement. They must:
    *   Analyze all network traffic for other hosts communicating with the known Emotet C2 IPs.
    *   Investigate the initial access vector (likely a phishing email with a malicious attachment or link).
    *   Assume credentials have been dumped and look for signs of their reuse across the network.
5.  **BLOCK INDICATORS:** Immediately block all C2 IP addresses identified in the Hybrid Analysis report at the network firewall. Add the file hash `a4513379dad5233afa402cc56a8b9222` to the EDR blocklist.
6.  **RECOVERY:** The compromised host cannot be trusted and must be wiped and re-imaged from a known-good source.
















