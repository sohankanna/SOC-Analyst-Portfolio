# 	SOC107 - Privilege Escalation Detected (Event ID:19)

## Executive Summary

On September 22, 2020, the Security Operations Center (SOC) received a critical alert for a privilege escalation event on the host **KatharinePRD** (172.16.15.78). The investigation confirmed the execution of a malicious file named `creditcard`, which is a known exploit for **CVE-2017-16995**, a critical vulnerability in the Linux kernel. The `Device Action: Allowed` status confirms the exploit was not blocked, and endpoint logs provide the "smoking gun" by showing the `creditcard` process running with **`root`** privileges. This is a **True Positive** for a successful, full compromise of the host at the highest privilege level.

## Incident Details

The initial alert was triggered by the execution of a known privilege escalation tool:

<img width="1449" height="539" alt="image" src="https://github.com/user-attachments/assets/1c5de419-34c4-486d-8aa9-55cb2e084347" />

| | |
| :--- | :--- |
| **Date of Incident**| September 22, 2020 |
| **Source Host**| KatharinePRD (172.16.15.78) |
| **Malware File**| creditcard |
| **File Hash (MD5)**| 7299c49dd85069e47d6514ab5e10c264 |
| **Vulnerability**| CVE-2017-16995 (Linux Kernel eBPF) |
| **Attack Type**| Local Privilege Escalation (LPE) |
| **Case Link**| *([Case link](https://app.letsdefend.io/case-management/casedetail/sohankanna/19))* |

## Investigation and Analysis

### 1. Vulnerability Profile: Linux Kernel eBPF Race Condition (CVE-2017-16995)

**CVE-2017-16995** is a high-severity vulnerability in the Linux kernel that allows for local privilege escalation. It was a significant vulnerability upon its discovery.
*   **How it Works:** The flaw exists in the kernel's eBPF (extended Berkeley Packet Filter) verifier. A race condition can be triggered by a local, unprivileged user. By exploiting this race condition, the user can cause a memory corruption error (out-of-bounds write) within the kernel itself. This allows them to execute code in the context of the kernel, effectively elevating their privileges to **`root`**.
*   **Impact:** A successful exploit means that any low-privileged user or process (like a web server) that has gained initial access to a machine can become `root`, the superuser with complete and unrestricted control over the entire system.
*   **The Exploit:** The file `creditcard` is a compiled C program—a public exploit—designed specifically to trigger this vulnerability and spawn a shell with `root` privileges.

### 2. Malware Analysis

Threat intelligence provided a definitive link between the file and the CVE.
*   **Threat Intelligence (VirusTotal):** The file hash was flagged as malicious by **42 security vendors**. Critically, the popular threat label is **`trojan.cve201716995/expl`**, which explicitly identifies this file as an exploit for the specific vulnerability in question.
    <img width="1666" height="872" alt="image" src="https://github.com/user-attachments/assets/eec49c39-2bb7-4eae-9ffc-e5b624575436" />
*   **Dynamic Analysis (Hybrid Analysis):** A sandbox run returned a **100/100 malicious score**, corroborating the VirusTotal findings and confirming the file's hostile nature.
    <img width="1574" height="682" alt="image" src="https://github.com/user-attachments/assets/51e9a20a-29b0-4411-aa22-1c781ef2000e" />

### 3. Confirmation of Successful Exploitation

The investigation confirmed that the exploit was successfully executed on the host.
*   **Execution Allowed:** The SIEM alert clearly states the `Device Action` was `Allowed`, meaning the EDR/antivirus did not block the malicious file from running.
*   **Endpoint Logs (The "Smoking Gun"):** EDR logs provide the definitive proof of success. They show the `creditcard` process running on the host, and most importantly, they show that the process is running with the privilege level of **`root`**. A normal user process should never be running as `root`. This proves that the exploit worked as intended and the attacker successfully escalated their privileges to the highest level.
    <img width="987" height="180" alt="image" src="https://github.com/user-attachments/assets/35bbfee0-25c7-4954-8e92-8ac06e7ed545" />

## Skills and Tools Utilized

*   **Tools Used:** SIEM, EDR, VirusTotal, Hybrid Analysis
*   **Skills Demonstrated:** LPE Analysis (Linux), CVE Triage, Log Correlation, TTP Recognition.

## Playbook Solution: Incident Classification

*   **Analyze Malware:** **Malicious.** The file is a known exploit for a critical kernel vulnerability.
*   **Was the Attack Successful?** **Yes.** The process was executed and achieved `root` privileges.
*   **Do You Need Tier 2 Escalation?** **Yes.** A successful root-level compromise of a host is a critical incident.
*   **Incident Classification:** **True Positive.**

## Conclusion and Recommendations

The alert for SOC107 was a **true positive** for a critical and successful local privilege escalation attack. An attacker, having already gained initial access, deployed and executed a known exploit for CVE-2017-16995 to gain `root` access on the **KatharinePRD** host. The system is fully compromised and under attacker control.

**Recommendations:**

1.  **CONTAINMENT - Isolate Host Immediately:** Disconnect the host **KatharinePRD** (172.16.15.78) from the network to prevent the attacker from using their `root` access for lateral movement or data exfiltration.
2.  **ESCALATE:** Immediately escalate this incident to the Tier 2/Incident Response (IR) team for a full forensic investigation.
3.  **INVESTIGATION:** This is now a two-part investigation:
    *   **Initial Access:** The IR team must determine *how* the attacker gained their initial low-privileged access to run the `creditcard` exploit.
    *   **Post-Escalation Activity:** The team must perform a full forensic analysis to determine what the attacker did *after* gaining `root` privileges. This includes searching for persistence mechanisms, credential theft, and any outbound C2 connections.
4.  **RECOVERY:** The compromised host cannot be trusted and must be wiped and re-imaged from a known-good source after it has been fully patched.
5.  **PATCHING:** The root cause of this incident is an unpatched kernel. All Linux systems in the environment must be audited and patched against CVE-2017-16995 immediately.
6.  **BLOCK INDICATORS:** Add the file hash `7299c49dd85069e47d6514ab5e10c264` to the EDR blocklist.




















