# 	SOC115 - Wscript.exe Usage as Dropper (Event ID:47)

## Executive Summary

On January 31, 2021, the Security Operations Center (SOC) received an alert for suspicious activity involving `wscript.exe` on the host **DanielPRD** (172.16.17.33). The investigation confirmed the execution of a highly sophisticated and malicious VBScript file, `injector.vbs`. Static and dynamic analysis revealed a multi-stage, heavily obfuscated script designed to perform anti-analysis checks, establish persistence, and download and execute a secondary payload from a remote server. The `Device Action: Allowed` and corresponding endpoint logs showing the execution of `wscript.exe` with the malicious script as its argument confirm that the host was successfully compromised. This is a **True Positive** for a critical security incident.

## Incident Details

The initial alert was triggered by the suspicious use of the Windows Script Host (`wscript.exe`):

<img width="1368" height="600" alt="image" src="https://github.com/user-attachments/assets/78b6ff85-3ae4-47ae-81c6-d443925c03d2" />

| | |
| :--- | :--- |
| **Date of Incident**| January 31, 2021 |
| **Source Host**| DanielPRD (172.16.17.33) |
| **Malware File**| injector.vbs |
| **File Hash (MD5)**| 1773cf37129003d9788c79b1a7bc155e |
| **Attack Type**| Malware Dropper / Script-Based Attack |
| **Case Link**| *([Case link)](https://app.letsdefend.io/case-management/casedetail/sohankanna/47)* |

## Investigation and Analysis

### 1. Alert Context: Wscript.exe as a Dropper

The rule `SOC115 - Wscript.exe Usage as Dropper` is designed to detect a common "living-off-the-land" (LOLBin) technique. `Wscript.exe` is a legitimate Windows component for executing scripts. Attackers abuse it to run malicious code that often acts as a "dropper" or "downloader" for a more substantial, secondary payload. This method helps evade simple application whitelisting and signature-based detection.

### 2. Malware Analysis (Obfuscated VBScript)

A deep analysis of the `injector.vbs` file revealed a highly sophisticated, multi-layered threat.
*   **Threat Intelligence:** VirusTotal confirmed the file was malicious with **20 vendor detections**, and Hybrid-Analysis also returned a malicious verdict.
    <img width="1842" height="852" alt="image" src="https://github.com/user-attachments/assets/e3f1f9bd-c4dc-4edf-a496-e852359741db" />
    <img width="1635" height="775" alt="image" src="https://github.com/user-attachments/assets/1e91d0d6-b60d-449e-8626-32e8aefc5d65" />
*   **Static Code Analysis:** The VBScript code is a textbook example of advanced obfuscation, designed to thwart analysis.
    *   **Initial Obfuscation:** The script uses meaningless variable names, string manipulation (`StrReverse`, `Replace`), and character code (`chr`) math to dynamically build commands at runtime. This hides keywords like `CreateObject` or `http` from static scanners.
    *   **Dynamic Code Execution:** The script's primary technique is its use of the `ScriptControl` object. It constructs a large string of numbers, then uses a dynamically generated piece of code to loop through these numbers, convert them back to characters, and assemble a second-stage script. This second script is then executed in memory using another `ScriptControl` object. This "in-memory execution" is a classic fileless attack technique.
    *   **Anti-Analysis and Evasion:** The script begins with a `wscript.sleep(30000)` command, pausing execution for 30 seconds. This is a common sandbox evasion technique, as many automated analysis systems will time out and classify the file as benign if it doesn't perform actions quickly. It also performs a WMI query to check if it's running on a 64-bit system and, if necessary, relaunches itself with the native 64-bit `wscript.exe` to break out of the 32-bit emulation layer, which can also confuse some analysis tools.
    *   **Payload Delivery:** The ultimate goal of the deobfuscated, second-stage script is to create an `MSXML2.XMLHTTP` object, connect to a hardcoded remote URL, download the final payload, and execute it using the `Execute()` function.
    *   **Persistence:** The script also contains a function designed to create a shortcut (`.lnk`) file in the user's Startup folder. This ensures that the `injector.vbs` script will run again every time the user logs in, making the infection persistent.

### 3. Confirmation of Successful Execution

The investigation confirmed that the malicious script was successfully executed on the host.
*   **SIEM Alert:** The initial alert clearly states `Device Action: Allowed`, meaning the EDR/antivirus did not block the file's execution at the outset.
*   **Endpoint Logs:** EDR logs provide the "smoking gun." They show the `wscript.exe` process being executed with the path to the malicious `injector.vbs` file. This confirms the user clicked on the file (or it was executed by another process), and the Windows Script Host successfully ran the malicious code.
    <img width="1305" height="243" alt="image" src="https://github.com/user-attachments/assets/1a9dcd81-8b6a-4db3-8a1f-49e90b5ea756" />

## Skills and Tools Utilized

*   **Tools Used:** SIEM, EDR, VirusTotal, Hybrid Analysis, Static Code Analysis
*   **Skills Demonstrated:** Malware Analysis (VBScript), LOLBin Technique Recognition (Wscript), Obfuscation Analysis, Persistence and Evasion TTP Recognition, Log Correlation.

## Playbook Solution: Incident Classification

*   **Analyze Malware:** **Malicious.** The file is a confirmed multi-stage, obfuscated VBScript dropper.
*   **Was the Attack Successful?** **Yes.** The script was allowed to execute on the endpoint.
*   **Do You Need Tier 2 Escalation?** **Yes.** A successful malware execution on a host, especially one with advanced evasion and persistence capabilities, is a critical incident.
*   **Incident Classification:** **True Positive.**

## Conclusion and Recommendations

The alert for SOC115 was a **true positive**. An attacker successfully executed a sophisticated and malicious VBScript dropper on the host **DanielPRD**. The host is compromised, and it must be assumed that a secondary, more potent malware payload was downloaded and executed, and that a persistence mechanism was successfully created.

**Recommendations:**

1.  **CONTAINMENT - Isolate Host Immediately:** Disconnect the host **DanielPRD** (172.16.17.33) from the network to prevent any secondary payload from establishing C2 communication or spreading laterally.
2.  **CREDENTIALS - Disable and Reset:** Immediately disable the `Daniel` user account and reset their password.
3.  **ESCALATE:** Immediately escalate this incident to the Tier 2/Incident Response (IR) team for a full forensic investigation.
4.  **INVESTIGATION:** The IR team must perform a full forensic analysis to:
    *   Deobfuscate the VBScript to identify the C2 URL(s).
    *   Analyze network logs to see if the secondary payload was successfully downloaded and from where.
    *   Locate and remove the persistence mechanism (the `.lnk` file in the Startup folder).
    *   Identify and analyze the secondary payload itself.
5.  **RECOVERY:** The compromised host must be wiped and re-imaged from a known-good source.
6.  **BLOCK INDICATORS:** Add the hash of `injector.vbs` (`1773cf37129003d9788c79b1a7bc155e`) to the EDR blocklist. Any C2 domains or IPs identified during the deeper investigation must be blocked at the network perimeter.
7.  **Initial Access Vector:** The IR team should also investigate how `injector.vbs` was delivered to the host (e.g., phishing email, malicious download).








