# 	SOC104 - Malware Detected (Event ID 31)


## Executive Summary

On October 29, 2020, the Security Operations Center (SOC) received a critical alert for malware detected on the host **JohnComputer** (172.16.17.82). The investigation confirmed the execution of a malicious file, `Purchase-Order_NO.231101.exe`, which was definitively identified by threat intelligence as the **Agent Tesla** information stealer. The `Device Action: Allowed` status indicates that endpoint security controls failed to prevent the malware's execution. Endpoint logs confirm the user ran the malicious file. Given Agent Tesla's capabilities, the host is fully compromised, and all credentials stored on it must be considered stolen. This is a **True Positive** critical incident requiring immediate incident response.

## Incident Details

The initial alert was triggered by the detection of a known malicious executable:

<img width="1449" height="526" alt="image" src="https://github.com/user-attachments/assets/2cef6128-143a-4142-816c-0cb51219cc5c" />

| | |
| :--- | :--- |
| **Date of Incident**| October 29, 2020 |
| **Source Host**| JohnComputer (172.16.17.82) |
| **Malware File**| Purchase-Order_NO.231101.exe |
| **File Hash (MD5)**| cdde99520664ac313d43964620019c61 |
| **Malware Family**| Agent Tesla (Infostealer/RAT) |
| **Attack Type**| Information Stealer / Trojan |
| **Case Link**| *([Case link](https://app.letsdefend.io/case-management/casedetail/sohankanna/31))* |

## Investigation and Analysis

### 1. Malware Profile: Agent Tesla

**Agent Tesla** is a prolific and dangerous .NET-based malware, sold as a Malware-as-a-Service (MaaS). Its primary function is to act as a powerful **information stealer** and Remote Access Trojan (RAT).
*   **Capabilities:** It is designed to steal a wide variety of sensitive information from a victim's machine, including:
    *   Credentials from web browsers (cookies, saved passwords).
    *   Credentials from email clients (Outlook, Thunderbird).
    *   Credentials from FTP clients and VPN software.
    *   Keystrokes (keylogger functionality).
    *   Screenshots of the victim's desktop.
*   **Delivery:** It is most commonly delivered via phishing emails with malicious attachments, often disguised as legitimate business documents like purchase orders, invoices, or shipping notifications, which matches the filename `Purchase-Order_NO.231101.exe` perfectly.

### 2. Malware Analysis

Threat intelligence provided a definitive identification and behavioral profile of the malware.
*   **Threat Intelligence (VirusTotal):** The file hash was flagged as malicious by **59 out of 71 security vendors**, with the most common threat label being **`trojan.msil/agenttesla`**.
    <img width="1799" height="859" alt="image" src="https://github.com/user-attachments/assets/4d593f4c-abad-4079-83dc-56ff6785f699" />
*   **Dynamic Analysis (Hybrid Analysis):** A sandbox run returned a **100/100 malicious score** and provided a detailed breakdown of its behaviors, which are all classic Agent Tesla TTPs:
    *   **Spyware/Stealer:** Actively accesses sensitive browser files, reads FTP and Putty/WinSCP registry keys.
    *   **Persistence:** Modifies the registry to ensure it runs automatically at startup.
    *   **Defense Evasion:** Uses long `sleep` timers to try and outlast automated sandbox analysis.
    <img width="1665" height="779" alt="image" src="https://github.com/user-attachments/assets/9adc2805-36c8-44e4-8b36-0c5e1ad844b0" />

### 3. Confirmation of Successful Execution

The investigation confirmed that the user executed the malware and the host was compromised.
*   **Execution Allowed:** The SIEM alert clearly states the `Device Action` was `Allowed`, meaning the EDR/antivirus did not block the malicious file from running.
*   **Endpoint Logs (The "Smoking Gun"):** EDR logs show the process `Purchase-Order_NO.231101.exe` running on the host "JohnComputer." This confirms the user was tricked into running the file, and the malware was successfully executed.
    <img width="970" height="222" alt="image" src="https://github.com/user-attachments/assets/27882ba7-a8e4-43ab-97df-7bb7c4fe39b9" />

## Skills and Tools Utilized

*   **Tools Used:** SIEM, EDR, VirusTotal, Hybrid Analysis
*   **Skills Demonstrated:** Malware Analysis (Infostealer), TTP Recognition, Log Correlation, Threat Intelligence Synthesis.

## Playbook Solution: Incident Classification

*   **Analyze Malware:** **Malicious.** The file is a confirmed Agent Tesla infostealer.
*   **Was the Attack Successful?** **Yes.** The malware was allowed to execute on the endpoint.
*   **Do You Need Tier 2 Escalation?** **Yes.** A successful infostealer infection is a critical incident.
*   **Incident Classification:** **True Positive.**

## Conclusion and Recommendations

The alert for SOC104 was a **true positive** for a critical infection by the Agent Tesla malware. The host **JohnComputer** is fully compromised. Due to the nature of Agent Tesla, it must be assumed that all credentials stored on or entered into the machine since the time of infection have been stolen.

**Recommendations:**

1.  **CONTAINMENT - Isolate Host Immediately:** Disconnect the host **JohnComputer** (172.16.17.82) from the network to prevent the malware from exfiltrating any more stolen data and to sever any C2 connection.
2.  **CREDENTIALS - Assume Full Compromise:**
    *   Immediately disable the `John` user account and force a password reset.
    *   This is not enough. All other personal and corporate credentials that may have been stored in the user's browser or other applications on that machine must be considered stolen and must be reset.
3.  **ESCALATE:** Immediately escalate this incident to the Tier 2/Incident Response (IR) team for a full-scale response.
4.  **INVESTIGATION:** The IR team must:
    *   Analyze network traffic from the host to identify the C2 server IP(s) and block them.
    *   Determine the initial access vector (this was almost certainly a phishing email) and hunt for it in other mailboxes.
5.  **RECOVERY:** The compromised host cannot be trusted and must be wiped and re-imaged from a known-good source.
6.  **BLOCK INDICATORS:** Add the file hash `cdde99520664ac313d43964620019c61` to the EDR blocklist.


























