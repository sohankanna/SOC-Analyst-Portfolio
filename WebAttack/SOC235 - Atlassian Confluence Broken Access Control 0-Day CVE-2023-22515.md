# SOC235 - Atlassian Confluence Broken Access Control 0-Day CVE-2023-22515
## Executive Summary

On November 9, 2023, the Security Operations Center (SOC) received a critical alert for the exploitation of **CVE-2023-22515**, a zero-day broken access control vulnerability, against the **Confluence Data Center** (172.16.17.234). The investigation confirmed a successful, scripted attack from the IP address **43.130.1.222**. The attacker exploited the vulnerability to reset the application's setup state, allowing them to create a new, unauthorized administrator account. Log analysis shows the attacker successfully completing the malicious setup process, confirmed by HTTP 200 and 302 responses to setup-related endpoints. This is a **True Positive** for a full compromise of the Confluence server and requires immediate incident response.

## Incident Details

The initial alert was triggered by a URL request matching the specific exploit pattern for CVE-2023-22515:

<img width="1558" height="595" alt="image" src="https://github.com/user-attachments/assets/b86a895f-16fb-4467-a670-806e8d971e64" />

| | |
| :--- | :--- |
| **Date of Incident**| November 9, 2023 |
| **Attacker IP**| 43.130.1.222 |
| **Destination Host**| Confluence Data Center (172.16.17.234) |
| **Attack Type**| Broken Access Control / Privilege Escalation (CVE-2023-22515) |
| **Case Link**| *([Case link ](https://app.letsdefend.io/case-management/casedetail/sohankanna/197))* |

## Investigation and Analysis

### 1. Vulnerability Profile: CVE-2023-22515

**CVE-2023-22515** is a critical-rated (CVSS 10.0) privilege escalation vulnerability affecting Atlassian Confluence Data Center and Server products. It is classified as a "Broken Access Control" flaw.

*   **How it Works:** The vulnerability allows a remote, unauthenticated attacker to send a specially crafted web request that resets the Confluence instance and tricks it into entering its initial setup mode.
*   **Impact:** Once the application is in setup mode, endpoints that are normally protected (like `/setup/setupadministrator.action`) become publicly accessible. This allows the attacker to complete the setup process themselves, which includes creating a new user account with full administrator privileges.
*   **Significance:** With an administrator account, the attacker has complete control over the Confluence instance. They can read all data (including sensitive corporate information), install malicious plugins (backdoors), delete data, and modify the application's configuration. The `User-Agent` of `curl/7.88.1` confirms this was a scripted, non-interactive attack, which is typical for exploiting this vulnerability.

### 2. Log Analysis: Deconstructing the 3-Step Attack Chain

The Confluence and web server logs show a clear, three-step process that perfectly matches the known exploitation method for this CVE.

<img width="1536" height="428" alt="image" src="https://github.com/user-attachments/assets/a029587e-d290-4316-905b-f3254c069965" />

**Step 1: Triggering the Vulnerability (Resetting Setup)**
<img width="638" height="293" alt="image" src="https://github.com/user-attachments/assets/89f458ad-12c6-409c-bee9-126b4a6c3cfd" />

*   **Request:** `GET /server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`
*   **Response:** `200 OK`
*   **Explanation:** This is the initial exploit. By sending `setupComplete=false`, the attacker fools the application into believing it has not yet been configured. The successful `200 OK` response confirms this step worked, and the Confluence instance is now vulnerable to a hostile takeover.

**Step 2: Creating the Malicious Admin Account**
<img width="644" height="258" alt="image" src="https://github.com/user-attachments/assets/fed3e5af-5de5-4a71-bd8f-5510a56b9e51" />

*   **Request:** `POST /setup/setupadministrator.action`
*   **Response:** `302 Redirect`
*   **Explanation:** Now that the server is in setup mode, the attacker sends a POST request to this normally-protected endpoint. The body of this request (not visible in these logs) contains the desired username and password for their new admin account. A `302 Redirect` is the expected response after a successful form submission, indicating the account was created and the server is redirecting to the next setup step.

**Step 3: Finalizing the Compromise**
<br>
<img width="638" height="262" alt="image" src="https://github.com/user-attachments/assets/8746847a-c59e-4f00-92c4-6efad4d5bbc6" />

*   **Request:** `POST /setup/finishsetup.action`
*   **Response:** `200 OK`
*   **Explanation:** This final request completes the malicious setup process. The `200 OK` response confirms that the new configuration, including the attacker's administrator account, has been saved. At this point, the attacker can log in with their new credentials.

The raw Confluence access log confirms this exact sequence and timing.
<img width="640" height="441" alt="image" src="https://github.com/user-attachments/assets/9b95c0b1-0d6a-4b3b-97ab-a1f6432d0f9a" />

### 3. Threat Intelligence

The source IP `43.130.1.222` was confirmed as malicious by internal threat intelligence and has some, albeit low, detection on VirusTotal. The behavioral evidence from the logs is far more conclusive than the IP reputation in this case.

<img width="1532" height="465" alt="image" src="https://github.com/user-attachments/assets/9ff1c7ca-bf95-4286-92cf-85c49a200e5e" />
<img width="1636" height="663" alt="image" src="https://github.com/user-attachments/assets/78b6d420-0845-4989-8b4b-d38649100b62" />

## Skills and Tools Utilized

*   **Tools Used:** SIEM, Confluence Access Logs
*   **Skills Demonstrated:** Web Exploit Analysis, Vulnerability Triage (CVE-2023-22515), Log Correlation, Attack Chain Reconstruction.

## Playbook Solution: Incident Classification

*   **Is Traffic Malicious?** **Yes.** It is a scripted exploit of a critical zero-day vulnerability.
*   **What Is The Attack Type?** **Broken Access Control / Privilege Escalation.**
*   **Was the Attack Successful?** **Yes.** The attacker successfully created a new administrator account.
*   **Do You Need Tier 2 Escalation?** **Yes.** A full server compromise requires immediate escalation.
*   **Incident Classification:** **True Positive.**

## Conclusion and Recommendations

The alert for SOC235 was a **true positive** for the successful exploitation of CVE-2023-22515. An external attacker has created a new administrator account and has complete control over the Confluence Data Center. The server, and all the intellectual property it contains, is compromised.

**Recommendations:**

1.  **CONTAINMENT - Isolate Server Immediately:** Disconnect the **Confluence Data Center** (172.16.17.234) from the network to prevent the attacker from exfiltrating data or using it as a pivot point.
2.  **PATCH IMMEDIATELY:** The absolute top priority is to apply the security patches released by Atlassian for CVE-2023-22515 to this and all other Confluence instances.
3.  **ESCALATE:** Immediately escalate this incident to the Tier 2/Incident Response team for a full forensic investigation.
4.  **INVESTIGATION:** The IR team must assume the attacker has had admin access since the time of the incident. They must search for **unexpected members of the `confluence-administrators` group**, **unexpected newly created user accounts**, and **any unknown or suspicious plugins** that may have been installed as a persistence mechanism.
5.  **ERADICATION & RECOVERY:** The server cannot be trusted. It must be rebuilt from a known-good backup from *before* the incident date. The configuration and user data can then be restored after verification.
6.  **BLOCK INDICATORS:** Block the attacker's IP address `43.130.1.222` at the network perimeter.
