# SOC287 - Arbitrary File Read on Checkpoint Security Gateway [CVE-2024-24919]

## Executive Summary

On June 6, 2024, the Security Operations Center (SOC) received a critical alert for the successful exploitation of **CVE-2024-24919**, a zero-day arbitrary file read vulnerability, against a **Check Point Security Gateway** (`CP-Spark-Gateway-01` at 172.16.20.146). The investigation confirmed that an external attacker from IP **203.160.68.12** successfully exfiltrated the `/etc/passwd` file. The attack was carried out by sending a specially crafted POST request containing a directory traversal payload. The server's response with an **HTTP 200 OK** and a non-zero response size confirms the data leak. A subsequent attempt by a related IP to access the more sensitive `/etc/shadow` file was blocked. This incident is a **True Positive** for a successful information disclosure breach on a critical perimeter device and requires immediate escalation.

## Incident Details

The initial alert was triggered by a request matching the specific exploit pattern for CVE-2024-24919:

‚≠ê *CVE-2024-24919 is a zero-day arbitrary file read in Check Point Security Gateways.*

| | |
| :--- | :--- |
| **Date of Incident**| June 6, 2024 |
| **Attacker IPs**| 203.160.68.12, 203.160.68.13 |
| **Destination Host**| CP-Spark-Gateway-01 (172.16.20.146) |
| **Attack Type**| Arbitrary File Read / LFI (CVE-2024-24919) |
| **Vulnerable Component**| Check Point Gateway `/clients/MyCRL` endpoint |
| **Case Link**| *[(Case link )](https://app.letsdefend.io/case-management/casedetail/sohankanna/263)* |

## Investigation and Analysis

### 1. Vulnerability and Payload Deconstruction

**CVE-2024-24919** is a critical information disclosure vulnerability affecting Check Point Security Gateways, which are often deployed at the network perimeter. The vulnerability allows an unauthenticated remote attacker to read arbitrary files on the system. This is particularly dangerous because these devices store sensitive configuration data and credentials.

The attacker's payloads, found in the request body of POST requests, used a classic directory traversal technique:
*   `aCSHELL/../../../../../../../../../../etc/passwd`
*   `aCSHELL/../../../../../../../../../../etc/shadow`

The `aCSHELL/...` string is likely a specific keyword required to trigger the vulnerable code path within the `/clients/MyCRL` web service. The `../` sequence instructs the file system to navigate up one directory, and by repeating it, the attacker breaks out of the web server's root directory to access sensitive files from the root of the operating system.

### 2. Log Analysis: Confirmation of a Partial Success

Analysis of the web server logs provides a clear timeline of the attack and its outcome.

<img width="633" height="731" alt="image" src="https://github.com/user-attachments/assets/fcafc864-dc3c-4fa8-ba7c-95e89511eaa7" />

*   **Successful Reconnaissance (`/etc/passwd`):**
    *   **Log Entry:** `203.160.68.12 ... "POST /clients/MyCRL HTTP/1.1" 200 1256 "aCSHELL/../../.../etc/passwd"`
    *   **Analysis:** This is definitive proof of a successful data leak. The **HTTP 200 OK** status confirms the server processed the request without error. The response size of **1256 bytes** confirms that the contents of the `/etc/passwd` file were sent back to the attacker. This file contains a list of all local user and service accounts on the gateway, providing the attacker with valuable intelligence for further attacks.

*   **Blocked Escalation Attempt (`/etc/shadow`):**
    *   **Log Entry:** `203.160.68.13 ... "POST /clients/MyCRL HTTP/1.1" 403 314 "aCSHELL/../../.../etc/shadow"`
    *   **Analysis:** The attacker, likely using a different IP from the same range, immediately attempted to escalate by accessing `/etc/shadow`, which contains the hashed passwords for the users discovered in `/etc/passwd`. The **HTTP 403 Forbidden** response indicates this attempt **failed**. The gateway's underlying file system permissions likely prevented the web service user from reading this highly restricted file.

## Skills and Tools Utilized

*   **Tools Used:** SIEM, Raw Log Files
*   **Skills Demonstrated:** LFI/Directory Traversal Analysis, Vulnerability Triage (CVE-2024-24919), Log Correlation, HTTP Status Code Analysis.

## Playbook Solution: Incident Classification

*   **Is Traffic Malicious?** **Yes.** It is a targeted exploit of a known critical vulnerability.
*   **What Is The Attack Type?** **Arbitrary File Read / Local File Inclusion (LFI).**
*   **Was the Attack Successful?** **Yes.** The attacker successfully exfiltrated the `/etc/passwd` file, constituting a data breach.
*   **Do You Need Tier 2 Escalation?** **Yes.** A successful exploit on a perimeter security gateway is a critical incident.
*   **Incident Classification:** **True Positive.**

## Conclusion and Recommendations

The alert for SOC287 was a **true positive** for the successful exploitation of CVE-2024-24919 on a perimeter Check Point firewall. While the attacker failed to access the password hashes in `/etc/shadow`, they successfully stole the list of system users. This information disclosure is a significant security breach that could facilitate further attacks like password spraying or brute-forcing against other services.

**Recommendations:**

1.  **PATCH IMMEDIATELY:** The absolute top priority is to apply the security patches released by Check Point for CVE-2024-24919 to this and all other susceptible gateways in the environment.
2.  **ESCALATE:** Immediately escalate this incident to the Tier 2/Incident Response and Network Security teams.
3.  **CREDENTIAL ROTATION:** As a precaution, all local user account passwords on the compromised gateway should be immediately reset. The attacker knows the usernames.
4.  **HUNT FOR FURTHER ACTIVITY:** The IR team should actively hunt for follow-on attacks. The attacker may use the disclosed usernames to attempt logins on VPN, SSH, or other management interfaces.
5.  **BLOCK INDICATORS:** Block the attacker's IP addresses (`203.160.68.12`, `203.160.68.13`) at the network edge.
