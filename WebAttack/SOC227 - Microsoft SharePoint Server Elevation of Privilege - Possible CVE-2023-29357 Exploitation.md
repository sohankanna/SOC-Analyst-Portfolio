# SOC227 - Microsoft SharePoint Server Elevation of Privilege - Possible CVE-2023-29357 Exploitation

## Executive Summary

On October 6, 2023, the Security Operations Center (SOC) received an alert for the potential exploitation of **CVE-2023-29357**, a critical privilege escalation vulnerability in Microsoft SharePoint Server. The investigation confirmed a successful attack against **MS-SharePointServer** (172.16.17.233) from the known malicious IP address **39.91.166.222**. The attacker, using an automated script, successfully bypassed authentication to access sensitive SharePoint API endpoints, including `/siteusers` and `/currentuser`, and received **HTTP 200 OK** responses containing data. This indicates the attacker has successfully elevated their privileges to that of an administrator. This is a **True Positive** for a critical security breach and requires immediate escalation.

## Incident Details

The initial alert was triggered by a request pattern indicative of CVE-2023-29357 exploitation:

<img width="736" height="605" alt="image" src="https://github.com/user-attachments/assets/cb49fc0a-f3bc-4612-a27a-ca36e33067df" />

| | |
| :--- | :--- |
| **Date of Incident**| October 6, 2023 |
| **Attacker IP**| 39.91.166.222 |
| **Destination Host**| MS-SharePointServer (172.16.17.233) |
| **Attack Type**| Privilege Escalation (CVE-2023-29357) |
| **Case Link**| ([Case link)](https://app.letsdefend.io/case-management/casedetail/sohankanna/189) |

## Investigation and Analysis

### 1. Vulnerability Profile: CVE-2023-29357

**CVE-2023-29357** is a critical (CVSS 9.8) authentication bypass vulnerability in Microsoft SharePoint Server. It allows a remote, unauthenticated attacker to gain the privileges of any other user, including administrators. The attacker achieves this by sending a specially crafted API request that tricks the server into impersonating a different user. This vulnerability is particularly dangerous because when chained with a code injection vulnerability (like CVE-2023-24955), it can lead to full Remote Code Execution (RCE). In this case, even without RCE, the attacker gaining admin-level access is a catastrophic breach. The `User-Agent` of `python-requests/2.28.1` confirms this was a scripted, automated attack, not manual browsing.

### 2. Log Analysis: Deconstructing the Successful Attack

The web server logs show a clear, logical progression of the attacker's actions, and the server's responses are the key to determining success.

<img width="1518" height="366" alt="image" src="https://github.com/user-attachments/assets/994dc538-32bd-4c4e-9611-e0d8c8fdcf2d" />

**Log Entry 1: The Successful Exploit** <br>
<img width="648" height="329" alt="image" src="https://github.com/user-attachments/assets/0f9ff247-1e51-4102-ad50-0ada3e30335e" />

*   **Request URL:** `/_api/web/siteusers`
*   **Response Status:** **200 OK**
*   **Response Size:** **1453 bytes**
*   **Explanation:** This is the most critical log. The `/_api/web/siteusers` endpoint returns a list of all users and groups that have access to a SharePoint site. Access to this API should be restricted to authenticated, privileged users. The fact that the attacker received a **`200 OK`** response with a **non-zero response size** means the server successfully processed the request and sent back the list of all site users. This confirms the attacker successfully bypassed authentication and escalated their privileges.


**Log Entry 2: Verification of Privileges**
<br>
<img width="645" height="333" alt="image" src="https://github.com/user-attachments/assets/6f85d239-c5e9-4820-aa03-7e80f4079fe3" />

*   **Request URL:** `/_api/web/currentuser`
*   **Response Status:** **200 OK**
*   **Response Size:** **1071 bytes**
*   **Explanation:** After gaining access, the attacker queries the `/_api/web/currentuser` endpoint. This is a logical next step to verify the identity of the user they have successfully impersonated. A `200 OK` response confirms they could see the details of the privileged account they were now using.

**Log Entry 3: A Failed, Malformed Request**
<img width="645" height="326" alt="image" src="https://github.com/user-attachments/assets/f343a137-764b-4ae9-aae3-8d7c010e0650" />

*   **Request URL:** `/_api/web/siteusers/web/siteusers`
*   **Response Status:** **404 Not Found**
*   **Explanation:** This log likely represents a typo or an error in the attacker's script where the path was duplicated. The `404 Not Found` response is expected for this invalid URL and does not detract from the fact that the previous requests were successful.

The IIS logs further corroborate this sequence of events, confirming the GET requests from the malicious IP and the corresponding HTTP status codes.
<img width="1181" height="58" alt="image" src="https://github.com/user-attachments/assets/601da872-0ab4-46de-928d-c45ee4ffba3f" />

### 3. Threat Intelligence

The source IP `39.91.166.222` was confirmed as malicious by both internal threat intelligence and AbuseIPDB, which shows over 1,400 reports.

<img width="1587" height="488" alt="image" src="https://github.com/user-attachments/assets/3d0fd7b5-8f8d-4116-8fcf-c1ce7ee3ef1b" />

## Skills and Tools Utilized

*   **Tools Used:** SIEM, IIS Logs, AbuseIPDB
*   **Skills Demonstrated:** Web Exploit Analysis, Vulnerability Triage (CVE-2023-29357), API Log Analysis, Log Correlation.

## Playbook Solution: Incident Classification

*   **Is Traffic Malicious?** **Yes.** It is a scripted exploit of a critical vulnerability from a known-bad IP.
*   **What Is The Attack Type?** **Privilege Escalation.**
*   **Was the Attack Successful?** **Yes.** The attacker successfully accessed privileged API endpoints.
*   **Do You Need Tier 2 Escalation?** **Yes.** A successful privilege escalation on a SharePoint server is a critical incident.
*   **Incident Classification:** **True Positive.**

## Conclusion and Recommendations

The alert for SOC227 was a **true positive** for the successful exploitation of CVE-2023-29357. An external attacker has bypassed authentication and gained administrative-level access to the SharePoint server, allowing them to view sensitive user data. The server and all data it contains must be considered compromised.

**Recommendations:**

1.  **PATCH IMMEDIATELY:** The absolute top priority is to apply the security patches released by Microsoft for CVE-2023-29357.
2.  **CONTAINMENT - Isolate Server:** Disconnect the **MS-SharePointServer** (172.16.17.233) from the network to prevent the attacker from taking further action, such as exfiltrating data or attempting RCE.
3.  **ESCALATE:** Immediately escalate this incident to the Tier 2/Incident Response team for a full forensic investigation.
4.  **INVESTIGATION:** The IR team must assume the attacker has had administrative access since the time of the incident. They must hunt for evidence of data exfiltration, creation of new admin accounts, or attempts to chain this exploit with a code execution vulnerability.
5.  **CREDENTIAL ROTATION:** As a precaution, all user passwords for accounts on the SharePoint server should be reset, as the attacker has exfiltrated the full user list.
6.  **BLOCK INDICATORS:** Block the attacker's IP address `39.91.166.222` at the network perimeter.
